CHIáº¾N LÆ¯á»¢C TRIá»‚N KHAI ANTIGRAVITY VIBE RAGHá»‡ thá»‘ng nÃ y Ä‘Æ°á»£c thiáº¿t káº¿ Ä‘á»ƒ xá»­ lÃ½ dá»¯ liá»‡u phi cáº¥u trÃºc phá»©c táº¡p vá»›i Ä‘á»™ chÃ­nh xÃ¡c cao nhá» cÆ¡ cháº¿ Contextual Hybrid Retrieval.I. Táº¦NG Xá»¬ LÃ Dá»® LIá»†U (DATA INGESTION)1. TrÃ­ch xuáº¥t Ä‘a Ä‘á»‹nh dáº¡ng vá»›i DoclingThay vÃ¬ dÃ¹ng PyMuPDF chá»‰ Ä‘á»c text thÃ´, Docling báº£o toÃ n cáº¥u trÃºc báº£ng vÃ  tiÃªu Ä‘á».Má»¥c tiÃªu: Chuyá»ƒn Ä‘á»•i PDF/DOCX sang Markdown.Táº¡i sao Markdown? VÃ¬ Markdown giá»¯ Ä‘Æ°á»£c phÃ¢n cáº¥p (#, ##) giÃºp LLM hiá»ƒu Ä‘Æ°á»£c Ä‘Ã¢u lÃ  Ã½ chÃ­nh, Ä‘Ã¢u lÃ  ná»™i dung bá»• trá»£.2. Chiáº¿n lÆ°á»£c "Perfect Chunking" (Cáº¥u trÃºc hoÃ n háº£o)ChÃºng ta khÃ´ng dÃ¹ng má»™t bá»™ chia duy nháº¥t. ChÃºng ta dÃ¹ng quy trÃ¬nh 3 bÆ°á»›c:BÆ°á»›c 1: Structural Split: DÃ¹ng RecursiveCharacterTextSplitter vá»›i cÃ¡c separators lÃ  ["\n# ", "\n## ", "\n### ", "\n\n", "\n", " "]. Äiá»u nÃ y Ä‘áº£m báº£o cÃ¡c Ä‘oáº¡n vÄƒn khÃ´ng bá»‹ cáº¯t ngang xÆ°Æ¡ng.BÆ°á»›c 2: Semantic Refinement: ÄÆ°a cÃ¡c Ä‘oáº¡n Ä‘Ã£ chia vÃ o SemanticChunker.Logic: Náº¿u hai Ä‘oáº¡n vÄƒn cáº¡nh nhau cÃ³ khoáº£ng cÃ¡ch cosine trong khÃ´ng gian embedding nhá» hÆ¡n ngÆ°á»¡ng (threshold), chÃºng sáº½ Ä‘Æ°á»£c gá»™p láº¡i thÃ nh má»™t "Ä‘Æ¡n vá»‹ Ã½ nghÄ©a".Tham sá»‘: $500$ tokens/chunk, overlap $100$ tokens.BÆ°á»›c 3: Contextual Enrichment (Ká»¹ thuáº­t máº¥u chá»‘t): Vá»›i má»—i chunk, ta prepend má»™t Ä‘oáº¡n metadata.VÃ­ dá»¥: [Context: TÃ i liá»‡u ChÃ­nh sÃ¡ch BH - ChÆ°Æ¡ng 2: Quyá»n lá»£i - Má»¥c 2.1] Ná»™i dung: ...II. Táº¦NG NHÃšNG VÃ€ LÆ¯U TRá»® (EMBEDDING & VECTOR DB)1. Embedding vá»›i BGE-M3BGE-M3 lÃ  lá»±a chá»n hÃ ng Ä‘áº§u vÃ¬ kháº£ nÄƒng Multi-Functionality:Dense Retrieval: Khá»›p Ã½ nghÄ©a ngá»¯ cáº£nh.Sparse Retrieval (Lexical): Khá»›p tá»« khÃ³a chÃ­nh xÃ¡c (giá»‘ng BM25).Multi-Vector: Cho phÃ©p biá»ƒu diá»…n má»™t Ä‘oáº¡n vÄƒn báº±ng nhiá»u vector Ä‘á»ƒ tÄƒng Ä‘á»™ phá»§.2. Qdrant & Payload FilteringQdrant khÃ´ng chá»‰ lÆ°u vector. HÃ£y táº­n dá»¥ng Payload Ä‘á»ƒ lÆ°u Metadata:Filtering: Khi User há»i vá» "Há»£p Ä‘á»“ng nÄƒm 2023", há»‡ thá»‘ng sáº½ lá»c ngay láº­p tá»©c báº±ng Metadata year: 2023 trÆ°á»›c khi thá»±c hiá»‡n tÃ¬m kiáº¿m vector. Viá»‡c nÃ y loáº¡i bá» nhiá»…u tá»« cÃ¡c nÄƒm khÃ¡c, giÃºp tÄƒng tá»‘c Ä‘á»™ vÃ  Ä‘á»™ chÃ­nh xÃ¡c.III. Táº¦NG TRUY XUáº¤T NÃ‚NG CAO (ADVANCED RETRIEVAL)Há»‡ thá»‘ng Ã¡p dá»¥ng cÃ´ng thá»©c Hybrid Search + MMR:Hybrid Search: Káº¿t há»£p Ä‘iá»ƒm sá»‘ tá»« Semantic Search (BGE) vÃ  Keyword Search.MMR (Maximal Marginal Relevance): * Váº¥n Ä‘á»: ÄÃ´i khi Top-5 káº¿t quáº£ tráº£ vá» Ä‘á»u nÃ³i cÃ¹ng má»™t Ã½.Giáº£i phÃ¡p: MMR sáº½ chá»n káº¿t quáº£ Top-1, sau Ä‘Ã³ á»Ÿ cÃ¡c vá»‹ trÃ­ tiáº¿p theo, nÃ³ sáº½ chá»n nhá»¯ng chunk vá»«a liÃªn quan Ä‘áº¿n cÃ¢u há»i, vá»«a khÃ¡c biá»‡t nháº¥t so vá»›i Top-1. Äiá»u nÃ y tá»‘i Æ°u hÃ³a lÆ°á»£ng thÃ´ng tin cung cáº¥p cho LLM.Reranker: BGE-Reranker-v2-M3Sau khi láº¥y ra Top-K (vÃ­ dá»¥ 10-15 chunks), ta Ä‘Æ°a qua Reranker. BÆ°á»›c nÃ y cá»±c ká»³ quan trá»ng vÃ¬ Vector Search Ä‘Ã´i khi bá»‹ "Ä‘Ã¡nh lá»«a" bá»Ÿi cÃ¡c tá»« ngá»¯ tÆ°Æ¡ng Ä‘á»“ng nhÆ°ng khÃ¡c ngá»¯ nghÄ©a. Reranker sáº½ cháº¥m Ä‘iá»ƒm láº¡i tá»«ng cáº·p (CÃ¢u há»i, Chunk) Ä‘á»ƒ tráº£ vá» 3-5 chunk "vÃ ng".IV. Bá»˜ NHá»š VÃ€ ÄIá»€U KHIá»‚N (MEM0 & GUARDRAILS)1. Mem0 (Long-term User Memory)Thay vÃ¬ dÃ¹ng ConversationBufferMemory (chá»‰ nhá»› trong 1 phiÃªn chat), Mem0 giÃºp há»‡ thá»‘ng:Ghi nhá»› sá»Ÿ thÃ­ch ngÆ°á»i dÃ¹ng qua nhiá»u ngÃ y (VÃ­ dá»¥: "NgÆ°á»i dÃ¹ng thÃ­ch cÃ¢u tráº£ lá»i ngáº¯n gá»n").Tá»± Ä‘á»™ng cáº­p nháº­t profile ngÆ°á»i dÃ¹ng khi cÃ³ thÃ´ng tin má»›i.2. Guardrails (ChÃ­nh sÃ¡ch há»‡ thá»‘ng)Sá»­ dá»¥ng Prompt-based Policy trong System Message:"Báº¡n lÃ  trá»£ lÃ½ áº£o Antigravity. Chá»‰ sá»­ dá»¥ng thÃ´ng tin Ä‘Æ°á»£c cung cáº¥p trong Context Ä‘á»ƒ tráº£ lá»i. Náº¿u khÃ´ng biáº¿t, hÃ£y nÃ³i 'TÃ´i khÃ´ng cÃ³ dá»¯ liá»‡u'. Tuyá»‡t Ä‘á»‘i khÃ´ng tá»± suy diá»…n."V. Cáº¤U HÃŒNH PHáº¦N Cá»¨NG & MÃ” HÃŒNHLLM: Qwen2.5-14b-instruct-q4_k_m.ggufCháº¡y tá»‘t trÃªn Card Ä‘á»“ há»a cÃ³ 12GB+ VRAM hoáº·c cháº¡y CPU thÃ´ng qua Llama.cpp/Ollama.ÄÃ¢y lÃ  model máº¡nh nháº¥t trong phÃ¢n khÃºc táº§m trung vá» kháº£ nÄƒng suy luáº­n tiáº¿ng Viá»‡t vÃ  tiáº¿ng Anh.UI: Streamlit vá»›i component st.chat_message Ä‘á»ƒ táº¡o tráº£i nghiá»‡m mÆ°á»£t mÃ .ğŸ›  Báº¢NG Tá»”NG Há»¢P THAM Sá» Cáº¤U HÃŒNHThÃ nh pháº§nTham sá»‘ khuyáº¿n nghá»‹Chunk Size / Overlap500 / 100Semantic ThresholdPercentile 95Top-K Retrieval10 chunksTop-K Rerank3 chunksTemperature (LLM)0.1 (Ä‘á»ƒ trÃ¡nh sÃ¡ng táº¡o quÃ¡ má»©c)Distance MetricCosine Similarity